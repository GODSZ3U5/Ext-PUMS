<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Mantenimiento</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!-- jQuery primero -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<!-- Luego Popper.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Y finalmente Bootstrap -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>
        .form-group {
            margin-bottom: 1.5rem;
        }
        .tooltip-icon {
            margin-left: 5px;
            cursor: pointer;
            color: #007bff;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2 class="mb-4">Formulario de Mantenimiento</h2>
    <form id="mantenimientoForm">
        <div class="form-group">
            <label for="nombre">Nombre</label>
            <span class="tooltip-icon" data-toggle="tooltip" title="Su nombre de usuario">&#x3f;</span>
            <input type="text" class="form-control" id="nombre" placeholder="" required>
        </div>

        <div class="form-group">
            <label for="cargo">Cargo</label>
            <span class="tooltip-icon" data-toggle="tooltip" title="Ingrese el cargo del usuario del mantenimiento">&#x3f;</span>
            <input type="text" class="form-control" id="cargo" placeholder="" required>
        </div>

        <div class="form-group">
            <label for="usuario_da">Usuario DA</label>
            <span class="tooltip-icon" data-toggle="tooltip" title="Ingrese el usuario DA del usuario del mantenimiento">&#x3f;</span>
            <input type="text" class="form-control" id="usuario_da" placeholder="" required>
        </div>

        <div class="form-group">
            <label for="activo_fijo">Activo Fijo del Equipo</label>
            <span class="tooltip-icon" data-toggle="tooltip" title="Ingrese el número de activo fijo del equipo al cual se le va realizar el proceso (en caso de ser un cambio, porfavor ingrese el del equipo que va a quedar activo)">&#x3f;</span>
            <input type="text" class="form-control" id="activo_fijo" placeholder="" required>
        </div>

        <div class="form-group">
            <label for="contrasena">Contraseña de Acceso al Equipo</label>
            <span class="tooltip-icon" data-toggle="tooltip" title="Ingrese la contraseña de acceso al equipo, correo, etc">&#x3f;</span>
            <input type="password" class="form-control" id="contrasena" placeholder="" required>
        </div>

        <div class="form-group">
            <label for="contacto">Número de Contacto</label>
            <span class="tooltip-icon" data-toggle="tooltip" title="Ingrese el o los números de contacto separados con '-'">&#x3f;</span>
            <input type="text" class="form-control" id="contacto" placeholder="" required>
        </div>

        <div class="form-group">
            <label for="tarea">Tarea a Realizar</label>
            <select class="form-control" id="tarea" required>
                <option value="">Seleccione...</option>
                <option value="revision">Revisión por daño</option>
                <option value="cambio">Cambio de equipo</option>
            </select>
        </div>

        <div class="form-group">
            <label for="especificacion">Especificación del Caso 
                <span class="tooltip-icon" data-toggle="tooltip" title="Ingrese una descripción de por qué está solicitando un mantenimiento">&#x3f;</span>
            </label>
            <textarea class="form-control" id="especificacion" rows="3" placeholder="" required></textarea>
        </div>

        <div class="form-group">
            <label for="observaciones">Observaciones 
                <span class="tooltip-icon" data-toggle="tooltip" title="Ingrese datos adicionales sobre el mantenimiento no antes especificados">&#x3f;</span>
            </label>
            <textarea class="form-control" id="observaciones" rows="3" placeholder=""></textarea>
        </div>

        <div class="form-group">
            <label for="fecha_mantenimiento">Fecha del Mantenimiento</label>
            <input type="date" class="form-control" id="fecha_mantenimiento" required>
        </div>

        <button type="submit" class="btn btn-primary">Enviar</button>
    </form>
</div>

<!-- Scripts de Bootstrap -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });

    document.getElementById("mantenimientoForm").addEventListener("submit", function(event) {
        event.preventDefault();

        // Obtener los valores de los campos del formulario
        var nombre = document.getElementById("nombre").value;
        var cargo = document.getElementById("cargo").value;
        var usuarioDA = document.getElementById("usuario_da").value;
        var activoFijo = document.getElementById("activo_fijo").value;
        var contrasena = document.getElementById("contrasena").value;  // Contraseña como texto sin mostrar en el HTML
        var numeroContacto = document.getElementById("contacto").value;
        var tarea = document.getElementById("tarea").options[document.getElementById("tarea").selectedIndex].text;
        var especificacion = document.getElementById("especificacion").value;
        var observaciones = document.getElementById("observaciones").value;
        var fechaMantenimiento = document.getElementById("fecha_mantenimiento").value;

        // Concatenar los datos en una sola descripción con '>'
        var descripcion = `Nombre: ${nombre} > Cargo: ${cargo} > Usuario DA: ${usuarioDA} > Activo Fijo: ${activoFijo} > Contraseña: ${contrasena} > Contacto: ${numeroContacto} > Tarea: ${tarea} > Especificación: ${especificacion} > Observaciones: ${observaciones}`;

        // Preparar los datos para enviar a la API
        var data = {
            Usuario: usuarioDA,  // Asegúrate de que el usuario sea el id correcto
            Fecha: fechaMantenimiento,
            Descripcion: descripcion
        };

        // Enviar los datos a la API
        fetch('http://localhost:5134/api/Casos/crear-caso', { // Asegúrate de poner la URL correcta de tu API
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Error en la respuesta de la API.");
            }
            return response.json();
        })
        .then(data => {
            console.log('Datos enviados:', data);
            alert('Formulario enviado con éxito. Número de caso: ' + data.num_caso);
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('Hubo un error al enviar los datos.');
        });
    });
</script>

</body>
</html>
